#!/bin/bash


r() {
	echo "+ $*"
	"$@"
}

joinhalf() {
	COLUMNS=$(tput cols)
	half=$(( ( COLUMNS - 2) / 2 ))
	tmp1=$(<<<"$1" tr '\t' ' ' | cut -c -"$half")
	tmp2=$(<<<"$2" tr '\t' ' ' | cut -c -"$half")
	paste -d '|' - <(cat <<<"$tmp2") <<<"$tmp1" |
	column -t -s '|'
}


C_stats() {
	text=$(
		exec 2>&1
		r df -h "$fs"
		r btrfs scrub status "$fs"
		r btrfs filesystem show "$fs"
		r btrfs filesystem df "$fs"
		r btrfs balance status "$fs"
		r btrfs scrub status "$fs"
		r btrfs filesystem usage "$fs"
	)
	mapfile -t lines <<<"$text"
	LINES=$(tput lines)
	tmp1=$(printf "%s\n" "${lines[@]:0:$LINES}")
	tmp2=$(printf "%s\n" "${lines[@]:$LINES}")
	joinhalf "$tmp1" "$tmp2"
}

fs=/

. ,lib_lib C_ "$@"
