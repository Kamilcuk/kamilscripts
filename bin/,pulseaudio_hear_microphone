#!/bin/bash
set -euo pipefail

name=$(basename "$0")
l() {
	echo "$name:" "$*"
}
on() {
	l "Enabling..."
	pactl load-module module-loopback latency_msec=1 >/dev/null
}
off() {
	l "Disabling..."
	pactl unload-module module-loopback
}
check() {
	! pactl list | grep -q module-loopback
}
toggle() {
	if check; then
		on
	else
		off
	fi
}
usage() {
	cat <<EOF
Usage:
	$name <disable|off|0>
	$name <enable|on|1>
	$name [toggle]
	$name <-h|--help>
EOF
}

if ((!$#)); then toggle; fi
while (($#)); do
	case "$1" in
	disable|off|0) off; ;;
	enable|on|1) on; ;;
	toggle)	toggle; ;;
	-h|--help|*) usage; ;;
	esac
done
